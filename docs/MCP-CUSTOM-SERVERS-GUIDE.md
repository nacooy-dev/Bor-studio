# MCP 自定义服务器功能指南

## 概述

Bor 智能体中枢现在支持添加自定义 MCP 服务器！用户可以通过输入 GitHub 仓库地址、npm 包名或 PyPI 包名来动态添加新的 MCP 服务器到市场中。

## 🚀 新功能特性

### 1. 多源支持
- **GitHub 仓库**: 直接从 GitHub 仓库解析 MCP 服务器
- **npm 包**: 支持 Node.js 生态的 MCP 服务器
- **PyPI 包**: 支持 Python 生态的 MCP 服务器

### 2. 智能解析
- **自动信息提取**: 从 README、package.json 等文件自动提取服务器信息
- **智能推断**: 自动推断安装命令、类别、标签和配置参数
- **置信度评估**: 显示解析结果的可信度

### 3. 用户友好界面
- **三步向导**: 输入地址 → 解析信息 → 确认配置
- **实时验证**: 输入验证和配置检查
- **可视化反馈**: 清晰的进度指示和状态反馈

## 📋 使用指南

### 添加自定义服务器

#### 步骤 1: 打开添加对话框
1. 在 MCP 配置页面点击"添加自定义服务器"按钮
2. 进入三步添加向导

#### 步骤 2: 输入服务器地址
支持以下格式：

**GitHub 仓库**:
```
https://github.com/owner/repo-name
```

**npm 包**:
```
npm:package-name
https://npmjs.com/package/package-name
```

**PyPI 包**:
```
pypi:package-name
https://pypi.org/project/package-name
```

#### 步骤 3: 确认配置
系统会自动解析服务器信息，你可以：
- 查看解析置信度
- 阅读系统建议
- 调整服务器配置
- 修改参数设置

### 管理自定义服务器

#### 查看自定义服务器
- 自定义服务器会显示在服务器市场中
- 带有"custom"标签标识
- 可以像其他服务器一样安装和使用

#### 编辑自定义服务器
- 点击服务器的"编辑"按钮
- 修改配置参数
- 保存更改

#### 删除自定义服务器
- 在服务器列表中找到自定义服务器
- 点击"删除"按钮确认删除

## 🔍 解析机制详解

### GitHub 仓库解析

系统会尝试获取以下信息：
1. **仓库基本信息**: 名称、描述、星标数等
2. **package.json**: Node.js 项目的包信息
3. **README 文件**: 安装说明和使用指南
4. **推断逻辑**: 基于文件内容推断配置

### 智能推断算法

#### 安装命令推断
- 检测 `package.json` → 使用 `npx`
- README 中包含 `uvx` → 使用 `uvx`
- 仓库名包含 `python` → 使用 `uvx`
- 默认使用 `npx`

#### 类别推断
基于描述和 README 内容的关键词：
- `file`, `storage` → 文件系统
- `search`, `web` → 搜索
- `database`, `sql` → 数据库
- `git`, `github` → 开发工具
- `note`, `wiki` → 知识管理

#### 参数推断
- 检测 `api key`, `token` → 添加 API 密钥参数
- 检测 `path`, `directory` → 添加路径参数
- 分析 README 中的配置说明

### 置信度计算

系统会根据以下因素计算解析置信度：
- **基础分数**: 30%
- **有 package.json**: +30%
- **README 内容丰富**: +20%
- **描述详细**: +10%
- **检测到参数**: +10%

## 💡 最佳实践

### 选择优质服务器
1. **检查仓库活跃度**: 选择有持续更新的项目
2. **查看文档质量**: README 详细的项目通常更可靠
3. **验证安全性**: 确认服务器来源可信
4. **测试功能**: 安装后测试基本功能

### 配置优化
1. **仔细检查解析结果**: 特别是置信度较低时
2. **调整参数设置**: 根据实际需求修改配置
3. **添加必要参数**: 补充系统未检测到的参数
4. **选择合适类别**: 确保分类正确便于查找

### 安全考虑
1. **验证服务器来源**: 只添加可信的服务器
2. **检查权限要求**: 了解服务器需要的系统权限
3. **测试环境隔离**: 在测试环境中先验证功能
4. **定期更新**: 保持服务器版本更新

## 🔧 故障排除

### 常见问题

#### 解析失败
**问题**: 无法解析服务器信息
**解决方案**:
1. 检查网络连接
2. 确认地址格式正确
3. 验证仓库/包是否存在
4. 尝试手动配置

#### 置信度低
**问题**: 解析置信度很低
**解决方案**:
1. 仔细检查解析结果
2. 手动调整配置参数
3. 参考官方文档
4. 联系服务器作者

#### 安装失败
**问题**: 自定义服务器安装失败
**解决方案**:
1. 检查系统环境
2. 验证配置参数
3. 查看错误日志
4. 尝试手动安装

### 调试技巧

#### 查看解析详情
- 注意解析建议
- 检查置信度指标
- 验证推断的参数

#### 测试配置
- 先在测试环境验证
- 检查必需的系统工具
- 确认网络访问权限

## 📊 统计和管理

### 自定义服务器统计
系统会跟踪：
- 总数量
- 验证状态
- 最近添加
- 使用频率

### 导入导出功能
- **导出**: 备份自定义服务器配置
- **导入**: 从备份恢复或分享配置
- **格式**: 标准 JSON 格式

## 🔮 未来计划

### 短期改进
1. **更多数据源**: 支持 GitLab、Bitbucket 等
2. **批量导入**: 从配置文件批量添加
3. **社区分享**: 分享和发现优质自定义服务器
4. **自动更新**: 检测和更新自定义服务器

### 长期规划
1. **AI 辅助解析**: 使用 AI 提升解析准确度
2. **社区评分**: 用户评价和推荐系统
3. **安全扫描**: 自动安全检查
4. **版本管理**: 服务器版本跟踪和管理

## 示例场景

### 场景 1: 添加 GitHub 上的新 MCP 服务器

假设你发现了一个有趣的 MCP 服务器：`https://github.com/example/awesome-mcp-server`

1. **输入地址**: 在添加对话框中输入 GitHub URL
2. **自动解析**: 系统解析仓库信息，提取配置
3. **确认配置**: 检查解析结果，调整必要参数
4. **添加成功**: 服务器出现在市场中，可以安装使用

### 场景 2: 添加 npm 包

发现一个 npm 上的 MCP 服务器包：`npm:my-mcp-server`

1. **输入包名**: 使用 `npm:` 前缀或直接输入 npmjs.com 链接
2. **包信息解析**: 系统从 npm registry 获取包信息
3. **配置确认**: 验证安装命令和参数
4. **集成完成**: 服务器可以通过 npx 安装

### 场景 3: 团队共享自定义服务器

团队开发了内部 MCP 服务器，需要在团队间共享：

1. **添加服务器**: 每个成员添加团队服务器
2. **导出配置**: 一个成员导出自定义服务器配置
3. **分享配置**: 通过文件或消息分享 JSON 配置
4. **批量导入**: 其他成员导入配置，快速获得相同设置

## 总结

自定义服务器功能大大扩展了 Bor 智能体中枢的能力边界。用户不再局限于预设的服务器列表，可以：

- **发现新工具**: 从开源社区发现最新的 MCP 服务器
- **快速集成**: 通过简单的地址输入快速添加新功能
- **个性化定制**: 根据具体需求配置和调整服务器
- **团队协作**: 在团队间分享和同步自定义配置

这个功能让 Bor 智能体中枢真正成为了一个开放、可扩展的 AI 工具平台，用户可以根据自己的需求无限扩展其能力！