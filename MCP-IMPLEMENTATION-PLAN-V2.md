# MCPé›†æˆå®æ–½è®¡åˆ’ V2.0 - åŸºäº5ireæ¡†æ¶

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

**è®©æ™ºèƒ½åŠ©æ‰‹è‡ªä¸»å­¦ä¹ MCPå·¥å…·æ–‡æ¡£ï¼Œåœ¨å¯¹è¯ä¸­è‡ªç„¶è°ƒç”¨MCPå·¥å…·ï¼ŒåŒæ—¶ä¿æŒç³»ç»Ÿè½»é‡åŒ–**

## ğŸ“Š å½“å‰é¡¹ç›®çŠ¶æ€åˆ†æ

### ç°æœ‰æ¶æ„ä¼˜åŠ¿ âœ…
- **æˆç†Ÿçš„æ„å›¾è¯†åˆ«ç³»ç»Ÿ** - `IntentRecognizer` + `DialogueRouter`
- **å®Œæ•´çš„LLMç®¡ç†** - å¤šä¾›åº”å•†æ”¯æŒï¼Œé…ç½®ç®¡ç†å®Œå–„
- **Electronæ¡Œé¢æ¶æ„** - ä¸5ireæŠ€æœ¯æ ˆåŒ¹é…
- **Vue.jså‰ç«¯** - ç°ä»£åŒ–å“åº”å¼ç•Œé¢
- **è½»é‡åŒ–è®¾è®¡** - é€‚åˆç¬”è®°æœ¬ç”µè„‘ç¯å¢ƒ

### éœ€è¦é›†æˆçš„åŠŸèƒ½
- **5ire MCPæ ¸å¿ƒ** - MCPæœåŠ¡å™¨ç®¡ç†å’Œstdioåè®®
- **æ™ºèƒ½å·¥å…·å­¦ä¹ ** - è‡ªåŠ¨å‘ç°å’Œå­¦ä¹ MCPå·¥å…·
- **è‡ªç„¶è¯­è¨€å·¥å…·è°ƒç”¨** - åœ¨å¯¹è¯ä¸­æ— ç¼è°ƒç”¨å·¥å…·
- **MCPç®¡ç†ç•Œé¢** - é€šè¿‡è‡ªç„¶è¯­è¨€è§¦å‘çš„ç®¡ç†ç•Œé¢

## ğŸ—ï¸ è½»é‡åŒ–é›†æˆæ¶æ„

### æ ¸å¿ƒåŸåˆ™
1. **æœ€å°åŒ–ä¾èµ–** - åªé›†æˆ5ireçš„æ ¸å¿ƒMCPåŠŸèƒ½
2. **å†…å­˜ä¼˜åŒ–** - æŒ‰éœ€åŠ è½½MCPæœåŠ¡å™¨
3. **æ€§èƒ½ä¼˜å…ˆ** - å¼‚æ­¥å¤„ç†ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹
4. **æ¸è¿›å¢å¼º** - ä¿æŒç°æœ‰åŠŸèƒ½ä¸å—å½±å“

### æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç°æœ‰å¯¹è¯ç³»ç»Ÿ   â”‚    â”‚   MCPå·¥å…·å­¦ä¹ å™¨   â”‚    â”‚   5ire MCPæ ¸å¿ƒ   â”‚
â”‚                â”‚    â”‚                  â”‚    â”‚                â”‚
â”‚ â€¢ IntentRecognizer â”‚â—„â”€â”€â–ºâ”‚ â€¢ å·¥å…·å‘ç°        â”‚â—„â”€â”€â–ºâ”‚ â€¢ æœåŠ¡å™¨ç®¡ç†     â”‚
â”‚ â€¢ DialogueRouter  â”‚    â”‚ â€¢ æ–‡æ¡£è§£æ        â”‚    â”‚ â€¢ stdioåè®®     â”‚
â”‚ â€¢ LLMé›†æˆ        â”‚    â”‚ â€¢ æ™ºèƒ½åŒ¹é…        â”‚    â”‚ â€¢ å·¥å…·æ‰§è¡Œ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

### é˜¶æ®µ1: 5ireæ ¸å¿ƒé›†æˆ (2-3å¤©)

#### 1.1 ç ”ç©¶å’Œæå–5ireæ ¸å¿ƒä»£ç 
- [ ] å…‹éš†5ireé¡¹ç›®å¹¶åˆ†ææ ¸å¿ƒæ¨¡å—
- [ ] è¯†åˆ«å…³é”®æ–‡ä»¶ï¼šMCPç®¡ç†å™¨ã€stdioåè®®ã€å·¥å…·å‘ç°
- [ ] æå–è½»é‡åŒ–çš„æ ¸å¿ƒåŠŸèƒ½

#### 1.2 åˆ›å»ºMCPæ ¸å¿ƒæ¨¡å—
```typescript
// src/lib/mcp/
â”œâ”€â”€ manager.ts          # MCPæœåŠ¡å™¨ç®¡ç†å™¨ (ä»5ireæå–)
â”œâ”€â”€ protocol.ts         # stdioåè®®å¤„ç† (ä»5ireæå–)
â”œâ”€â”€ discovery.ts        # å·¥å…·å‘ç°æœºåˆ¶ (ä»5ireæå–)
â”œâ”€â”€ types.ts           # MCPç±»å‹å®šä¹‰
â””â”€â”€ index.ts           # ç»Ÿä¸€å¯¼å‡º
```

#### 1.3 Electronä¸»è¿›ç¨‹é›†æˆ
- [ ] åœ¨ `electron/main.ts` ä¸­é›†æˆMCPç®¡ç†å™¨
- [ ] å®ç°IPCé€šä¿¡æ¥å£
- [ ] æ·»åŠ MCPç›¸å…³çš„Electron API

### é˜¶æ®µ2: å¢å¼ºæ„å›¾è¯†åˆ«ç³»ç»Ÿ (2å¤©)

#### 2.1 æ‰©å±•IntentTypeæ”¯æŒMCP
```typescript
// src/services/intent/IntentRecognizer.ts (å¢å¼º)
export enum IntentType {
  // ç°æœ‰ç±»å‹ä¿æŒä¸å˜
  LLM_MANAGEMENT = 'llm_management',
  SYSTEM_CONFIG = 'system_config',
  // ... å…¶ä»–ç°æœ‰ç±»å‹
  
  // æ–°å¢MCPç›¸å…³ç±»å‹
  MCP_MANAGEMENT = 'mcp_management',
  MCP_TOOL_CALL = 'mcp_tool_call',
  MCP_SERVER_CONTROL = 'mcp_server_control',
}
```

#### 2.2 åˆ›å»ºMCPå·¥å…·æ³¨å†Œå™¨
```typescript
// src/services/mcp/tool-registry.ts
class MCPToolRegistry {
  async discoverTools(): Promise<MCPTool[]>
  async registerTool(tool: MCPTool): Promise<void>
  async getToolByIntent(userInput: string): Promise<MCPTool | null>
}
```

#### 2.3 æ™ºèƒ½å‚æ•°æå–å™¨
```typescript
// src/services/mcp/parameter-extractor.ts
class ParameterExtractor {
  async extractParameters(userInput: string, tool: MCPTool): Promise<any>
  async validateParameters(params: any, schema: any): Promise<boolean>
}
```

### é˜¶æ®µ3: å¯¹è¯ç³»ç»Ÿé›†æˆ (2å¤©)

#### 3.1 åˆ›å»ºMCPå¯¹è¯å¤„ç†å™¨
```typescript
// src/services/dialogue/MCPDialogueHandler.ts
class MCPDialogueHandler implements DialogueHandler {
  async handle(userInput: string, intent: IntentResult): Promise<DialogueResponse>
  private async executeToolCall(tool: MCPTool, params: any): Promise<any>
  private async handleMCPManagement(userInput: string): Promise<DialogueResponse>
}
```

#### 3.2 æ›´æ–°DialogueRouter
- [ ] æ³¨å†ŒMCPDialogueHandler
- [ ] æ·»åŠ MCPå·¥å…·è°ƒç”¨è·¯ç”±é€»è¾‘
- [ ] ä¿æŒç°æœ‰ç³»ç»Ÿé…ç½®ç­‰åŠŸèƒ½ä¸å—å½±å“

### é˜¶æ®µ4: è½»é‡åŒ–UIé›†æˆ (1-2å¤©)

#### 4.1 MCPç®¡ç†ç»„ä»¶
```vue
<!-- src/components/MCPManager.vue -->
<template>
  <div class="mcp-manager">
    <!-- è½»é‡åŒ–çš„MCPæœåŠ¡å™¨ç®¡ç†ç•Œé¢ -->
  </div>
</template>
```

#### 4.2 è‡ªç„¶è¯­è¨€è§¦å‘
- [ ] é€šè¿‡æ„å›¾è¯†åˆ«è§¦å‘MCPç®¡ç†ç•Œé¢
- [ ] é›†æˆåˆ°ç°æœ‰çš„å¯¹è¯æµç¨‹ä¸­

### é˜¶æ®µ5: æµ‹è¯•å’Œä¼˜åŒ– (1å¤©)

#### 5.1 åŠŸèƒ½æµ‹è¯•
- [ ] MCPæœåŠ¡å™¨ç®¡ç†æµ‹è¯•
- [ ] å·¥å…·å‘ç°å’Œè°ƒç”¨æµ‹è¯•
- [ ] å¯¹è¯é›†æˆæµ‹è¯•

#### 5.2 æ€§èƒ½ä¼˜åŒ–
- [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- [ ] å¯åŠ¨æ—¶é—´ä¼˜åŒ–
- [ ] å“åº”é€Ÿåº¦ä¼˜åŒ–

## ğŸ› ï¸ å…·ä½“å®æ–½æ­¥éª¤

### ç¬¬1æ­¥: åˆ›å»ºMCPæ ¸å¿ƒæ¨¡å—ç»“æ„

```typescript
// src/lib/mcp/types.ts
export interface MCPServer {
  id: string
  name: string
  command: string
  args: string[]
  env?: Record<string, string>
  status: 'stopped' | 'starting' | 'running' | 'error'
}

export interface MCPTool {
  name: string
  description: string
  server: string
  schema: any
  examples?: string[]
}

export interface MCPToolCall {
  tool: string
  parameters: any
  server: string
}
```

### ç¬¬2æ­¥: é›†æˆ5ire MCPç®¡ç†å™¨

```typescript
// src/lib/mcp/manager.ts (ä»5ireæå–å¹¶è½»é‡åŒ–)
export class MCPManager {
  private servers: Map<string, MCPServer> = new Map()
  private tools: Map<string, MCPTool> = new Map()
  
  async startServer(config: MCPServer): Promise<void>
  async stopServer(id: string): Promise<void>
  async listTools(serverId?: string): Promise<MCPTool[]>
  async executeTool(call: MCPToolCall): Promise<any>
  
  // è½»é‡åŒ–å®ç°ï¼ŒæŒ‰éœ€åŠ è½½
  private async loadServerOnDemand(id: string): Promise<void>
}
```

### ç¬¬3æ­¥: å¢å¼ºæ„å›¾è¯†åˆ«

```typescript
// src/services/intent/IntentRecognizer.ts (å¢å¼ºç‰ˆ)
export class IntentRecognizer {
  private mcpToolRegistry?: MCPToolRegistry
  
  async recognizeIntent(userInput: string, history?: Message[]): Promise<IntentResult> {
    // 1. ç°æœ‰æ„å›¾è¯†åˆ«é€»è¾‘
    const basicIntent = await this.recognizeBasicIntent(userInput, history)
    
    // 2. MCPå·¥å…·æ„å›¾è¯†åˆ«
    if (this.mcpToolRegistry) {
      const toolIntent = await this.recognizeMCPToolIntent(userInput)
      if (toolIntent.confidence > basicIntent.confidence) {
        return toolIntent
      }
    }
    
    return basicIntent
  }
  
  // ä¿æŒç°æœ‰æ–¹æ³•ä¸å˜ï¼Œæ·»åŠ æ–°çš„MCPç›¸å…³æ–¹æ³•
  private async recognizeMCPToolIntent(userInput: string): Promise<IntentResult>
}
```

### ç¬¬4æ­¥: å¯¹è¯ç³»ç»Ÿé›†æˆ

```typescript
// src/services/dialogue/DialogueRouter.ts (å¢å¼ºç‰ˆ)
export class DialogueRouter {
  constructor() {
    // ä¿æŒç°æœ‰å¤„ç†å™¨
    this.handlers.set(IntentType.LLM_MANAGEMENT, new LLMManagementHandler())
    this.handlers.set(IntentType.SYSTEM_CONFIG, new SystemConfigHandler())
    
    // æ·»åŠ MCPå¤„ç†å™¨
    this.handlers.set(IntentType.MCP_TOOL_CALL, new MCPToolCallHandler())
    this.handlers.set(IntentType.MCP_MANAGEMENT, new MCPManagementHandler())
  }
}
```

## ğŸ¯ è½»é‡åŒ–ç­–ç•¥

### å†…å­˜ä¼˜åŒ–
1. **æŒ‰éœ€åŠ è½½** - MCPæœåŠ¡å™¨åªåœ¨éœ€è¦æ—¶å¯åŠ¨
2. **å·¥å…·ç¼“å­˜** - æ™ºèƒ½ç¼“å­˜å¸¸ç”¨å·¥å…·ä¿¡æ¯
3. **è¿æ¥æ± ** - å¤ç”¨MCPè¿æ¥ï¼Œé¿å…é¢‘ç¹åˆ›å»º

### æ€§èƒ½ä¼˜åŒ–
1. **å¼‚æ­¥å¤„ç†** - æ‰€æœ‰MCPæ“ä½œå¼‚æ­¥æ‰§è¡Œ
2. **è¶…æ—¶æ§åˆ¶** - è®¾ç½®åˆç†çš„å·¥å…·æ‰§è¡Œè¶…æ—¶
3. **é”™è¯¯æ¢å¤** - ä¼˜é›…å¤„ç†MCPæœåŠ¡å™¨å¼‚å¸¸

### èµ„æºç®¡ç†
1. **è‡ªåŠ¨æ¸…ç†** - å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„MCPè¿æ¥
2. **èµ„æºé™åˆ¶** - é™åˆ¶åŒæ—¶è¿è¡Œçš„MCPæœåŠ¡å™¨æ•°é‡
3. **ç›‘æ§å‘Šè­¦** - ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### åŠŸèƒ½æŒ‡æ ‡
- [ ] **MCPæœåŠ¡å™¨ç®¡ç†** - èƒ½å¤Ÿå¯åŠ¨ã€åœæ­¢ã€é…ç½®MCPæœåŠ¡å™¨
- [ ] **å·¥å…·è‡ªåŠ¨å‘ç°** - è‡ªåŠ¨å‘ç°å¹¶å­¦ä¹ MCPå·¥å…·
- [ ] **è‡ªç„¶è¯­è¨€è°ƒç”¨** - é€šè¿‡å¯¹è¯è‡ªç„¶è°ƒç”¨MCPå·¥å…·
- [ ] **ç³»ç»Ÿå…¼å®¹æ€§** - ä¸å½±å“ç°æœ‰LLMç®¡ç†ç­‰åŠŸèƒ½

### æ€§èƒ½æŒ‡æ ‡
- [ ] **å¯åŠ¨æ—¶é—´** - åº”ç”¨å¯åŠ¨æ—¶é—´å¢åŠ <2ç§’
- [ ] **å†…å­˜ä½¿ç”¨** - ç©ºé—²æ—¶å†…å­˜å¢åŠ <50MB
- [ ] **å“åº”æ—¶é—´** - å·¥å…·è°ƒç”¨å“åº”æ—¶é—´<5ç§’
- [ ] **ç¨³å®šæ€§** - 24å°æ—¶è¿è¡Œæ— å´©æºƒ

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- [ ] **å­¦ä¹ èƒ½åŠ›** - èƒ½å¤Ÿè‡ªåŠ¨å­¦ä¹ æ–°MCPå·¥å…·
- [ ] **è°ƒç”¨å‡†ç¡®ç‡** - >85%çš„å·¥å…·è°ƒç”¨æ„å›¾è¯†åˆ«å‡†ç¡®
- [ ] **å‚æ•°æå–ç‡** - >80%çš„å‚æ•°è‡ªåŠ¨æå–å‡†ç¡®
- [ ] **ç”¨æˆ·æ»¡æ„åº¦** - è‡ªç„¶çš„å·¥å…·è°ƒç”¨ä½“éªŒ

## ğŸš€ å®æ–½ä¼˜å…ˆçº§

### P0 (å¿…é¡»å®Œæˆ)
1. 5ire MCPæ ¸å¿ƒé›†æˆ
2. åŸºç¡€å·¥å…·å‘ç°å’Œè°ƒç”¨
3. æ„å›¾è¯†åˆ«ç³»ç»Ÿå¢å¼º

### P1 (é‡è¦)
1. æ™ºèƒ½å‚æ•°æå–
2. MCPç®¡ç†ç•Œé¢
3. æ€§èƒ½ä¼˜åŒ–

### P2 (ä¼˜åŒ–)
1. é«˜çº§å·¥å…·å­¦ä¹ 
2. å·¥å…·æ¨èç³»ç»Ÿ
3. ä½¿ç”¨ç»Ÿè®¡å’Œåˆ†æ

---

**è¿™ä¸ªæ–°çš„å®æ–½è®¡åˆ’åŸºäºå½“å‰å¹²å‡€çš„ä»£ç åº“ï¼Œä¸“æ³¨äºè½»é‡åŒ–é›†æˆ5ireçš„MCPæ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒæ—¶ä¿æŒç°æœ‰ç³»ç»Ÿçš„å®Œæ•´æ€§ã€‚æ‚¨è§‰å¾—è¿™ä¸ªæ–¹æ¡ˆå¦‚ä½•ï¼Ÿéœ€è¦æˆ‘å¼€å§‹å®æ–½æŸä¸ªå…·ä½“é˜¶æ®µå—ï¼Ÿ**